@{
    string state = @ViewBag.state;
    string idForm = @ViewBag.idForm;
    ViewBag.Title = "NewAccessUserIDRequest";
    string reason = @ViewBag.Reason;

}
<script src="~/Scripts/i18n/grid.locale-en.js"></script>
<link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" />
<link href="~/Content/jquery.jqGrid/ui.jqgrid.css" rel="stylesheet" />
<script src="~/Scripts/jquery-1.9.1.min.js"></script>
<script src="~/Scripts/jquery-ui-1.10.4.min.js"></script>
<script src="~/Scripts/jquery.jqGrid.min.js"></script>

@using (@Html.BeginForm(FormMethod.Post))
{
    <div class="row">
        <div class="col-lg-10">
            <h1 class="page-header">DELETE REQUEST</h1>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Delete Access & User ID Request
                </div>
                <div class="panel-body">
                    <div class="row" style="margin-bottom:20px">
                        <div class="col-lg-5">
                            <form role="form">


                                @Html.Label("Form Number :")

                                @if (@ViewBag.idForm != null)
                                {
                                    @Html.Label((String)@ViewBag.idForm, new { @class = "" })
                                    idForm = @ViewBag.idForm;
                                }
                                else
                                {
                                    @Html.Label("[Generated By System]", new { @class = "" })
                                }


                                <div class="form-group">
                                    @Html.Label("Request Date :")

                                    @Html.Label(@DateTime.Now.ToShortDateString(), new { })

                                </div>
                                <div class="form-group">
                                    @Html.Label("Reason :")

                                    @Html.DropDownList("pivchReason", (SelectList)@ViewBag.DelReason, reason, new { @class = "form-control" })

                                </div>
                                <div class="form-group">
                                    @if (@ViewBag.NIK != null)
                                    {
                                        @Html.Label("NIK :")

                                        @Html.TextBox("pivchNIK", (String)@ViewBag.NIK, new { @class = "form-control", @readonly = "readonly" })
                                        @Html.Hidden("pivchJobId", (String)@ViewBag.Job)


                                        @*if (@ViewBag.NIK != null)
                                        {
                                            
                                        }
                                            <a type="button" class="btn btn-default" data-toggle="modal" href="#myModal">Cek</a>*@


                                        
                                    }
                                    else
                                    {

                                        @Html.Label("NIK :")

                                        @Html.TextBox("pivchNIK", null, new { @class = "form-control", @readonly = "readonly" })


                                    }
                                </div>
                                <div class="form-group">

                                  
                                <a type="button" class="btn btn-default" data-toggle="modal" href="#myModal" >Cek</a>

                                    
                                </div>
                                @if (@ViewBag.Name != null)
                                {
                                    <div class="form-group">
                                        @Html.Label("Employee Name :")

                                        @Html.Label((String)@ViewBag.Name, new { })

                                    </div>
                                }
                                else
                                {
                                    <div class="form-group">
                                        @Html.Label("Employee Name :")

                                        @Html.Label("-")

                                    </div>
                                }
                                @if (@ViewBag.Branch != null)
                                {
                                    <div class="form-group">
                                        @Html.Label("Branch :")

                                        @Html.Label((String)@ViewBag.Branch, new { })

                                    </div>
                                }
                                else
                                {
                                    <div class="form-group">
                                        @Html.Label("Branch :")

                                        @Html.Label("-")

                                    </div>
                                }
                                @if (@ViewBag.Dept != null)
                                {
                                    <div class="form-group">
                                        @Html.Label("Departement :")

                                        @Html.Label((String)@ViewBag.Dept, new { })

                                    </div>
                                }
                                else
                                {
                                    <div class="form-group">
                                        @Html.Label("Departement :")

                                        @Html.Label("-")

                                    </div>
                                }
                                @if (@ViewBag.post != null)
                                {
                                    <div class="form-group">
                                        @Html.Label("Position :")

                                        @Html.Label((String)@ViewBag.post, new { })

                                    </div>
                                }
                                else
                                {
                                    <div class="form-group">
                                        @Html.Label("Position :")

                                        @Html.Label("-", new { })

                                    </div>
                                }
                                <div class="form-group">
                                    @Html.Label("Start / End Date :")

                                    @Html.Label("-")

                                </div>
                                @if (state == "Cancel")
                                {

                                }
                                else
                                {
                                    @*<div class="form-group" style="margin-bottom:20px">
                                        @Html.Label("Reason :")

                                        @Html.TextArea("pivchReason", new { @class = "form-control" })

                                    </div>*@
                                }
                            </form>

                        </div>
                    </div>
                    <div>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <input type="Submit" value="Process" class="btn btn-default" id="buttonSubmit" name="command" />
                                        <input type="button" value="Back" class="btn btn-default" id="buttonBack" onclick="window.location.href='@Url.Action("DeleteUserRequest", "AccessAndUserIDRequest", new {  })'" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<div class="modal" id="myModal">
    <div class="model fadeIn" id="modalId" tabindex="-1">
        <div class="modal-dialog" style="width:auto">
            <div class="modal-content">
                <div class="modal-header">
                    <a class="close" data-dismiss="modal">×</a>
                    <h3>NIK Search Prompt</h3>
                </div>
                <div>

                    <div class="col-lg-10">
                        @Html.Label("SearchBy", new { @class = "col-md-2 control-label" })

                        <div class="col-lg-5">
                            @Html.DropDownList("ParamField", (IEnumerable<SelectListItem>)ViewBag.menuNIK, "All", new { @class = "form-control" })

                        </div>

                        <div class="col-lg-5">
                            @Html.TextBox("SearchValue", null, new { @class = "form-control" })

                        </div>

                    </div>
                    <div class="modal-footer">
                        <input type="Submit" value="Search" class="btn btn-default" id="buttonSearch" />

                        <script type="text/javascript">
                            $(window).bind('resize', function () {
                                jQuery("#grid").setGridWidth($('.modal-footer').width(), true);
                            }).trigger('resize');

                            $('#buttonSearch').click(function () {
                                $("#grid").jqGrid({
                                    url: '@Url.Action("GetHRDeleteCurrentJobEmployee", "AccessAndUserIDRequest")',
                                    datatype: "JSON",
                                    mtype: "POST",
                                    
                                   
                                    postData: {

                                        ParamField: (function () {
                                            return $("#ParamField option:selected").val();
                                        }),
                                        SearchValue: (function () {
                                            return $("#SearchValue").val();
                                        }),
                                        pivchReason: (function () {
                                            return $("#pivchReason option:selected").val();
                                          
                                        })

                                    },
                                    colNames: ['NIK', 'Employee Name', 'Branch', 'Departement', 'Position', 'Job Employee Id', 'Action'],
                                    colModel: [
                                        { key: true, Name: true, name: 'NIK', editable: true, width: 100 },
                                        { key: false, name: 'EmployeeName', editable: true },
                                        { key: false, name: 'BranchName', editable: true, width: 100 },
                                        { key: false, name: 'DepartementName', editable: true, width: 110 },
                                        { key: false, name: 'PrivilegeName', editable: true, width: 150 },
                                        { key: false, name: 'JobEmployeeId', hidden: true, width: 150 },
                                        {


                                            name: 'Pick NIK', title: false,
                                            formatter: function (cellvalue, options, rowObject) {
                                                return '<a href="/HR/AccessAndUserIDRequest/NewDeleteUserRequest?value=' + rowObject.NIK + '&JobId=' + rowObject.JobEmployeeId + '&Reason=' + $("#pivchReason option:selected").val() + '">' +
                                                "Select" + "</a>";
                                            }
                                        }
                                    ],

                                    pager: '#pager',
                                    rowNum: 10,
                                    rowList: [10, 20, 30, 40],
                                    height: '80%',
                                    width: '50%',

                                    caption: 'User Request',
                                    emptyrecords: 'No records to display',

                                    jsonReader: {
                                        root: "rows",
                                        page: "page",
                                        total: "total",
                                        records: "records",
                                        repeatitems: false,
                                        cell: "cell",
                                        id: "id",
                                        userdata: "userdata",
                                    },

                                    multiselect: false,


                                });

                                $("#grid").trigger("reloadGrid", [{ page: 1 }]);

                            });
                            $(document).ready(function () {
                                $("#pivchReason").val('@reason');
                            });

                        </script>

                        <div class="panel-body" style="align-content:center">
                            <div id="divTable">
                                <table id="grid"></table>
                                <div id="pager"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
